<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate FCM Token</title>
</head>
<body>
    <h1>Click to Generate FCM Token</h1>
    <button onclick="generateFcmToken()">Generate</button>
    <p id="displayToken"></p>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
    import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-messaging.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA5mVd5i7E-PlLq0OSrtPKZQls7NxaOgcw",
        authDomain: "my-first-project-7a8f6.firebaseapp.com",
        projectId: "my-first-project-7a8f6",
        storageBucket: "my-first-project-7a8f6.appspot.com",
        messagingSenderId: "198672835954",
        appId: "1:198672835954:web:847a97342f38feb806e9eb",
    };

    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);
    const displayToken = document.getElementById("displayToken")

    // Register SW
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker
            .register("/generate_fcm_token/firebase-messaging-sw.js")
            .then((registration) => {
                console.log("âœ… Service Worker registered:", registration);
            })
            .catch((err) => {
                console.error("âŒ SW registration failed:", err);
            });
    }

    // Ask for permission and get token
    const requestPermission = async () => {
        const permission = await Notification.requestPermission();
        if (permission === "granted") {
            const currentToken = await getToken(messaging, {
                vapidKey: "BEoKRbT8OZ_tJL6vHy9tc0N2K09qlTypmaC3M60QQbRnFY7Ej983vL1AnVXuuBGEJAI7YkCAj-kzLclCCHmnXM8", // Get from Firebase Console > Cloud Messaging
                serviceWorkerRegistration: await navigator.serviceWorker.ready,
            });

            if (currentToken) {
                console.log("ðŸ“² FCM Token:", currentToken);
                displayToken.innerHTML = ""
                displayToken.innerHTML = currentToken
            // send to backend if needed
            } else {
                console.warn("âš ï¸ No token available");
            }
        } else {
            console.warn("âŒ Notification permission denied");
        }
    };

    requestPermission();

    window.generateFcmToken = async () => {
        getToken(messaging, { vapidKey: 'BEoKRbT8OZ_tJL6vHy9tc0N2K09qlTypmaC3M60QQbRnFY7Ej983vL1AnVXuuBGEJAI7YkCAj-kzLclCCHmnXM8' }).then((currentToken) => {
        if (currentToken) {
            console.log(currentToken)
            displayToken.innerHTML = ""
            displayToken.innerHTML = currentToken
        } else {
            // Show permission request UI
            console.log('No registration token available. Request permission to generate one.');
            // ...
        }
        }).catch((err) => {
            console.log('An error occurred while retrieving token. ', err);
        // ...
        });
    }
</script>
</body>
</html>